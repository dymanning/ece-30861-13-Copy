#!/usr/bin/env python3
import os
import sys
import subprocess

def main():
    if len(sys.argv) < 2:
        print("Usage: ./run [install|URL_FILE|test]")
        sys.exit(1)

    cmd = sys.argv[1]

    if cmd == "install":
        # Install deps in userland
        try:
            subprocess.check_call([sys.executable, "-m", "pip", "install", "--user", "-r", "requirements.txt"])
            sys.exit(0)
        except subprocess.CalledProcessError:
            sys.exit(1)

    elif cmd == "test":
        # run test suite with coverage
        sys.exit(subprocess.call(["pytest", "--maxfail=1", "--disable-warnings", "-q", "--cov=src", "--cov-report=term"]))

    else:
        # assume it's a URL file
        from main import main as run_main
        run_main(cmd)

if __name__ == "__main__":
    main()
