{% extends 'base.html' %}

{% block title %}{{ model.name if model else 'Model Details' }}{% endblock %}

{% block content %}
  {% if model %}
    <div class="mb-3">
      <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary mb-3" aria-label="Back to models dashboard">‚Üê Back to Models</a>
    </div>

    <div class="card">
      <div class="card-header bg-primary text-white">
        <h1 class="mb-0">{{ model.name }}</h1>
      </div>
      <div class="card-body">
        <!-- Basic Information -->
        <div class="row mb-4">
          <div class="col-md-6">
            <h5>Basic Information</h5>
            <dl class="row">
              <dt class="col-sm-3">Type:</dt>
              <dd class="col-sm-9"><span class="badge bg-info">{{ model.type }}</span></dd>
              
              <dt class="col-sm-3">ID:</dt>
              <dd class="col-sm-9"><code>{{ model.id }}</code></dd>
              
              {% if model.url %}
              <dt class="col-sm-3">URL:</dt>
              <dd class="col-sm-9">
                <a href="{{ model.url }}" target="_blank" rel="noopener noreferrer" aria-label="Open model URL in new tab">
                  {{ model.url[:50] }}...
                </a>
              </dd>
              {% endif %}
              
              {% if model.created_at %}
              <dt class="col-sm-3">Created:</dt>
              <dd class="col-sm-9">{{ model.created_at }}</dd>
              {% endif %}
              
              {% if model.size %}
              <dt class="col-sm-3">Size:</dt>
              <dd class="col-sm-9">{{ (model.size / 1024 / 1024) | round(2) }} MB</dd>
              {% endif %}
            </dl>
          </div>

          <!-- Quality Ratings -->
          <div class="col-md-6">
            {% if model.rating %}
            <h5>Quality Ratings</h5>
            <div class="progress mb-2">
              <div class="progress-bar" role="progressbar" aria-valuenow="{{ model.rating.quality or 0 }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ model.rating.quality or 0 }}%">
                Quality: {{ model.rating.quality or 'N/A' }}/100
              </div>
            </div>

            {% if model.rating.code_quality %}
            <div class="progress mb-2">
              <div class="progress-bar bg-info" role="progressbar" aria-valuenow="{{ model.rating.code_quality }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ model.rating.code_quality }}%">
                Code Quality: {{ model.rating.code_quality }}/100
              </div>
            </div>
            {% endif %}

            {% if model.rating.dataset_quality %}
            <div class="progress mb-2">
              <div class="progress-bar bg-success" role="progressbar" aria-valuenow="{{ model.rating.dataset_quality }}" aria-valuemin="0" aria-valuemax="100" style="width: {{ model.rating.dataset_quality }}%">
                Dataset Quality: {{ model.rating.dataset_quality }}/100
              </div>
            </div>
            {% endif %}
            {% else %}
            <p class="text-muted">No rating information available.</p>
            {% endif %}
          </div>
        </div>

        <!-- Metadata -->
        {% if model.metadata %}
        <div class="mb-4">
          <h5>Metadata</h5>
          <div class="bg-light p-3 rounded">
            <pre style="margin-bottom: 0;">{{ model.metadata | tojson(indent=2) }}</pre>
          </div>
        </div>
        {% endif %}

        <!-- Cost Information -->
        {% if model.cost %}
        <div class="mb-4">
          <h5>Cost Metrics</h5>
          <table class="table table-sm">
            <tbody>
              {% if model.cost.inference_cents %}
              <tr>
                <td>Inference Cost:</td>
                <td><strong>${{ (model.cost.inference_cents / 100) | round(2) }}</strong></td>
              </tr>
              {% endif %}
              {% if model.cost.storage_cents %}
              <tr>
                <td>Storage Cost:</td>
                <td><strong>${{ (model.cost.storage_cents / 100) | round(2) }}</strong></td>
              </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
        {% endif %}

        <!-- Dependencies -->
        {% if model.dependencies %}
        <div class="mb-4">
          <h5>Dependencies</h5>
          <ul>
            {% for dep in model.dependencies %}
            <li>{{ dep }}</li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        <!-- README -->
        {% if model.readme %}
        <div class="mb-4">
          <h5>README</h5>
          <div class="bg-light p-3 rounded border">
            {{ model.readme | safe }}
          </div>
        </div>
        {% endif %}

        <!-- Raw JSON (for debugging) -->
        <div class="accordion mb-3" id="advancedOptions">
          <div class="accordion-item">
            <h2 class="accordion-header" id="headingRaw">
              <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseRaw" aria-expanded="false" aria-controls="collapseRaw">
                Raw Data
              </button>
            </h2>
            <div id="collapseRaw" class="accordion-collapse collapse" aria-labelledby="headingRaw" data-bs-parent="#advancedOptions">
              <div class="accordion-body">
                <pre>{{ model | tojson(indent=2) }}</pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  {% else %}
    <div class="alert alert-warning" role="alert">
      <p>Model details could not be loaded.</p>
      <a href="{{ url_for('dashboard') }}" class="btn btn-sm btn-outline-secondary">Back to Models</a>
    </div>
  {% endif %}
{% endblock %}
